<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parallel Threads</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" />

  <!-- 封面圖片 -->
  <!-- <meta property="og:image" content="https://nine9.jic-tools.com.tw/themes/nine9/images/logo.png" />
  <meta name="twitter:image" content="https://nine9.jic-tools.com.tw/themes/nine9/images/logo.pngg" /> -->

  <style>
    textarea {
      height: 400px;
    }

    .muted {
      font-size: .9rem;
      color: #6c757d;
    }

    /* .sticky-actions {
      position: sticky;
      top: 12px;
      z-index: 10;
    } */

    /* 原本那段可以刪掉或取消 sticky
.sticky-actions { position: sticky; top: 12px; z-index: 10; }
*/

    @media (min-width: 992px) {

      /* 只在電腦版固定 */
      .right-pane-sticky {
        position: sticky;
        top: 12px;
        /* 距離視窗頂端 12px，可自行調整 */
        z-index: 10;
      }
    }



    /* 基本 placeholder 顏色 */
    #fz::placeholder,
    #fz::-webkit-input-placeholder,
    #fz::-moz-placeholder,
    #fz:-ms-input-placeholder {
      color: rgba(13, 110, 253, .35);
      transition: color .2s ease;
    }

    /* .blink 狀態下讓 placeholder 變亮，並加淡藍光暈 */
    #fz.blink::placeholder,
    #fz.blink::-webkit-input-placeholder,
    #fz.blink::-moz-placeholder,
    #fz.blink:-ms-input-placeholder {
      color: #0d6efd;
    }

    #fz.blink {
      box-shadow: 0 0 0 .25rem rgba(13, 110, 253, .15);
    }


    /* CE的部分 */
    .btn-ce {
      background: #eaffea;
      /* 淡綠底 */
      border: 1px solid #28a745;
      /* 綠框 */
      color: #28a745;
      /* 綠字 */
      font-weight: 700;
      padding: .125rem .5rem;
      border-radius: .35rem;
    }

    /* ===== Footer Style ===== */
    .site-footer {
      background: #3f474b;
      /* 深灰底，接近截圖 */
      color: #e9ecef;
    }

    .site-footer .footer-topbar {
      height: 10px;
      background: #c7c7c7;
      /* 頂部淺灰分隔帶 */
    }

    .site-footer a {
      color: #e9f2ff;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    /* .footer-logo {
      height: 38px;
    } */

    .footer-logo {
      height: 72px;
    }

    /* 調大：可改 64~80px 視覺試到好 */
    @media (min-width: 1200px) {
      .footer-logo {
        height: 80px;
      }

      /* 大螢幕再稍微放大 */
    }


    .badge-row img {
      height: 48px;
      margin-right: .35rem;
    }

    .duns-img {
      height: 60px;
    }

    .footer-sec-title {
      font-size: .95rem;
      text-transform: uppercase;
      letter-spacing: .04em;
      opacity: .9;
    }

    .footer-underline {
      height: 2px;
      width: 100%;
      background: rgba(255, 255, 255, .35);
      margin: .4rem 0 1rem;
    }

    /* RWD 微調：小螢幕置中、間距放大 */
    @media (max-width: 991.98px) {
      .site-footer .col-lg-4 {
        text-align: center;
      }
    }
  </style>




</head>

<body>
  <div class="container my-3">
    <h1 class="mb-4 my-3 d-flex align-items-center">
      <img src="https://nine9.jic-tools.com.tw/themes/nine9/images/logo.png" alt="Logo" height="100"
        style="margin-right: 10px;">

      <!-- <strong class="fw-bold">NC Helix Drill Zigzag Method-G code Generator</strong>  -->
      <strong class="fw-bold">NC Helix Drill </strong>
    </h1>

    <div class="row">
      <!-- 左側：參數區 -->
      <div class="col-md-6">
        <div class="row g-3">


          <!-- NEW：兩組 Part No. 選擇 -->
          <div class="col-12">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title mb-3 fw-bold">選擇 Part No.</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="partsGroup1" class="form-label fw-bold">Parts No.（99321 系列）</label>
                    <select id="partsGroup1" class="form-select" onchange="onPartSelect(this)">
                      <option value="" selected disabled>請選擇</option>
                      <option>00-99321-010-1320</option>
                      <option>00-99321-012-1525</option>
                      <option>00-99321-016-2030</option>
                      <option>00-99321-020-2540</option>
                      <option>00-99321-025-3050</option>
                    </select>
                  </div> <!-- 修正 <di> 為 <div> -->
                  <div class="col-md-6">
                    <label for="partsGroup2" class="form-label fw-bold">Part No.（99323 系列）</label>
                    <select id="partsGroup2" class="form-select" onchange="onPartSelect(this)">
                      <option value="" selected disabled>請選擇</option>
                      <option>00-99323-010-1320</option>
                      <option>00-99323-012-1525</option>
                      <option>00-99323-016-2030</option>
                      <option>00-99323-020-2540</option>
                      <option>00-99323-025-3050</option>
                    </select>
                  </div>
                </div>

                <div class="mt-3 muted" id="pickedPartInfo">尚未選擇 Part No.</div>

                <!-- 動態刀桿（延長桿）選項 -->
                <div class="mt-3 d-none" id="extensionBarBlock">
                  <label class="form-label fw-bold">選擇刀桿 (Extension Bar)</label>
                  <select class="form-select" id="extensionBarSelect">
                    <option value="" selected disabled>請選擇刀桿</option>
                    <!-- 由 JS 動態插入 -->
                  </select>

                  <!-- 這裡即時顯示選到哪一支刀桿 -->
                  <div class="mt-2 text-muted" id="extensionBarStatus">尚未選擇刀桿。</div>
                </div>
              </div>
            </div>
          </div>

          <!-- /NEW -->

          <hr class="my-4" />

          <div class="col-12 my-3">
            <div class="row g-3 align-items-start">
              <!-- 左：材質選擇 -->
              <div class="col-md-6 fw-bold">
                <label class="form-label">Workpiece material</label>
                <select class="form-select" id="selectMaterial" onchange="updateCuttingSpeed(); updateSelectColor()">
                  <option value="" disabled selected>Select material</option>

                  <!-- P ｜ Steel -->
                  <option value="Material01" data-group="P" data-color="#0066CC"
                    style="background-color:#0066CC;color:white;font-weight:bold;">P — Carbon steel C&lt;0.3%</option>
                  <option value="Material02" data-group="P" data-color="#0066CC"
                    style="background-color:#0066CC;color:white;font-weight:bold;">P — Carbon steel C&gt;0.3%</option>
                  <option value="Material03" data-group="P" data-color="#0066CC"
                    style="background-color:#0066CC;color:white;font-weight:bold;">P — Low alloy steel C&lt;0.3%
                  </option>
                  <option value="Material04" data-group="P" data-color="#0066CC"
                    style="background-color:#0066CC;color:white;font-weight:bold;">P — High alloy steel</option>

                  <!-- M ｜ Stainless -->
                  <option value="Material06" data-group="M" data-color="#FFC000"
                    style="background-color:#FFC000;font-weight:bold;">M — Stainless steel</option>

                  <!-- K ｜ Cast Iron -->
                  <option value="Material07" data-group="K" data-color="#FF0000"
                    style="background-color:#FF0000;color:white;font-weight:bold;">K — Cast iron</option>

                  <!-- N ｜ Non-ferrous -->
                  <option value="Material08" data-group="N" data-color="#00B050"
                    style="background-color:#00B050;color:white;font-weight:bold;">N — Al, Al-alloys</option>
                  <option value="Material09" data-group="N" data-color="#00B050"
                    style="background-color:#00B050;color:white;font-weight:bold;">N — Cu, Cu-alloy, casting Cu-alloy
                  </option>

                  <!-- S ｜ Heat/Ti -->
                  <option value="Material10" data-group="S" data-color="#E6007E"
                    style="background-color:#E6007E;color:white;font-weight:bold;">S — Heat resistant alloy</option>
                  <option value="Material11" data-group="S" data-color="#E6007E"
                    style="background-color:#E6007E;color:white;font-weight:bold;">S — Ti, Ti-alloy</option>

                  <!-- H ｜ Hardened -->
                  <option value="Material12" data-group="H" data-color="#A6A6A6"
                    style="background-color:#A6A6A6;font-weight:bold;">H — Hardened steel &lt; HRC50</option>
                </select>
                <small class="text-muted d-block mt-4 muted" id="materialHint">ISO group: –</small>

                <!-- 等Maggie圖片 -->
                <div class="card shadow-sm" id="imgCard">
                  <div class="card-body d-flex justify-content-center align-items-center" style="min-height:220px;">
                    <img id="galleryImg" src="https://picsum.photos/300/200?random=20" class="img-fluid rounded"
                      alt="preview">
                  </div>
                  <div class="card-footer bg-white border-0">
                    <div class="d-flex justify-content-between">
                      <button id="btnPrev" class="btn btn-outline-primary">← Previous</button>
                      <button id="btnNext" class="btn btn-outline-primary">Next →</button>
                    </div>
                  </div>
                </div>



              </div>

              <!-- 右：兩個欄位 + CE -->
              <div class="col-md-6">
                <label class="form-label fw-bold">Pre-bore diameter</label>
                <div class="input-group mb-2">
                  <input type="number" class="form-control" id="preBore" placeholder="mm" step="0.001">
                  <button type="button"
                    class="btn btn-light btn-sm border-success text-success fw-bold px-5 py-1 btn-ce"
                    id="preBoreCe">Clear</button>

                </div>

                <label class="form-label fw-bold">Machining Diameter</label>
                <div class="input-group">
                  <input type="number" class="form-control" id="machiningDia" placeholder="mm" step="0.001">
                  <button type="button"
                    class="btn btn-light btn-sm border-success text-success fw-bold px-5 py-1 btn-ce"
                    id="machiningDiaCe">Clear</button>

                </div>
              </div>
            </div>
          </div>



          <hr class="my-4" />

          <div class="col-md-6 fw-bold">
            <label class="form-label">Tool Diameter ØDc</label>
            <input type="text" class="form-control bg-light" id="toolDiameter" readonly style="cursor: not-allowed;"
              placeholder="Please Select Tool" oninput="updateSpindleSpeed()">
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Cutting Speed</label>
            <input type="number" class="form-control" id="vc" placeholder="m/min" oninput="updateSpindleSpeed()" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Spindle Speed</label>
            <input type="number" class="form-control" id="n" placeholder="RPM" readonly
              style="background-color: #d4edda; cursor: not-allowed;" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Number of Teeth</label>
            <input type="number" class="form-control bg-light" style="cursor: not-allowed;" id="z" value="2" readonly
              oninput="updateFeedRate()" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Feed per Tooth</label>
            <!-- <input type="number" class="form-control" id="fz" placeholder="mm/tooth" step="0.001"
              oninput="updateFeedRate()" /> -->
            <input type="number" class="form-control" id="fz" placeholder="mm/tooth" step="0.001" required
              oninput="updateFeedRate()" />

          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Feed Rate</label>
            <input type="number" class="form-control" id="vf" placeholder="mm/min" readonly
              style="background-color: #d4edda; cursor: not-allowed;" />
          </div>

          <hr class="my-4" />

          <div class="col-md-6 fw-bold">
            <label class="form-label">Thread Size</label>
            <select class="form-select" id="selectThreadSize">
              <option value="" disabled selected>Select Insert first</option>
            </select>
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Outer-Dia</label>
            <input type="number" class="form-control" id="od" placeholder="mm" step="0.001" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Tap Drill Diameter</label>
            <input type="number" class="form-control" id="tapDrill" placeholder="mm" step="0.001" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Thread Pitch</label>
            <input type="number" class="form-control" id="pitch" placeholder="mm" />
          </div>

          <div class="col-md-12 fw-bold">
            <label class="form-label">Thread Details</label>
            <textarea id="threadInfo" class="form-control" style="max-height: 110px; overflow-y: auto;"
              readonly></textarea>
          </div>

          <hr class="my-4" />

          <div class="col-md-6 fw-bold">
            <label class="form-label">Number Of Passes</label>
            <select class="form-select" id="passes" onchange="updatePassInputs()">
              <option value="1">1</option>
              <option value="2" selected>2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>

          <div class="col-12 fw-bold">
            <div class="row" id="passInputs"></div>
          </div>

          <hr class="my-4" />

          <div class="col-md-6 fw-bold">
            <label class="form-label">Depth of Cut</label>
            <input type="number" class="form-control" id="depth" value="16" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Tool Number</label>
            <input type="number" class="form-control" id="toolNo" value="99" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Coordinate System</label>
            <input type="text" class="form-control" id="gcode" value="G54" />
          </div>

          <hr class="my-4" />

          <div class="col-md-6 fw-bold">
            <label class="form-label">Coordinate X</label>
            <input type="number" class="form-control" id="x" value="0" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Coordinate Y</label>
            <input type="number" class="form-control" id="y" value="0" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Safe Height Z</label>
            <input type="number" class="form-control" id="zsafe" value="20" />
          </div>

          <div class="col-md-6 fw-bold">
            <label class="form-label">Surface Coordinate Z</label>
            <input type="number" class="form-control" id="zsurface" value="0" />
          </div>

          <hr class="my-4" />
        </div>
      </div>

      <!-- 右側：操作與輸出 -->
      <div class="col-md-6 my-6">
        <div class="right-pane-sticky">
          <div class="d-flex justify-content-end mb-2">
            <button class="btn btn-secondary me-2 fw-bold" onclick="addTool(); countClick('addTool')">Add Tool</button>
            <button class="btn btn-primary me-2 fw-bold"
              onclick="calculateGCode(); countClick('calculate')">Generate</button>
            <button class="btn btn-success me-2 fw-bold" onclick="exportToFile(); countClick('export')">Export</button>
            <button class="btn btn-danger fw-bold" onclick="clearOutput(); countClick('clear')">Clear</button>
          </div>
          <textarea id="result" class="form-control my-3" readonly></textarea>
        </div>
      </div>

    </div>
  </div>

  <script>

    // 料號→允許刀桿白名單 ---------------------------------------------------- //
    const PART_TO_BARS = {
      "00-99323-010-1320": ["00-99801-10S", "00-99801-10W"],  // 這支只允許 10S / 10W
      // 其他 99323 料號未列出時，預設允許 BAR_DB 全部型號
      "00-99323-012-1525": ["00-99801-12S", "00-99801-12W"], // 這支只允許 12S / 12W
      "00-99323-016-2030": ["00-99801-16S", "00-99801-14W", "00-99801-16W"], // 這支只允許 16S / 14W / 16W
      "00-99323-020-2540": ["00-99801-20S", "00-99801-18W", "00-99801-20W"], // 這支只允許 20S / 18W / 20W
      "00-99323-025-3050": ["00-99801-25S", "00-99801-25W",], // 這支只允許 25S / 25W

    };

    // ===== 刀桿資料庫（顯示用的型號/扭力，可日後補齊） =======================
    const BAR_DB = {
      "00-99801-10S": { type: "", torque: "" },
      "00-99801-10W": { type: "", torque: "" },

      "00-99801-12S": { type: "", torque: "" },
      "00-99801-12W": { type: "", torque: "" },
      "00-99801-14W": { type: "", torque: "" },

      "00-99801-16S": { type: "", torque: "" },
      "00-99801-16W": { type: "", torque: "" },
      "00-99801-18W": { type: "", torque: "" },

      "00-99801-20S": { type: "", torque: "" },
      "00-99801-20W": { type: "", torque: "" },

      "00-99801-25S": { type: "", torque: "" },
      "00-99801-25W": { type: "", torque: "" }
    };

    // ===== 料號 → Insert 直徑（Dc, mm） =====================================
    // * 先設定你指定的兩支 010-1320 為 11.0；之後可持續擴充
    const PART_TO_DIAMETER = {
      "00-99321-010-1320": 11.0,
      "00-99323-010-1320": 11.0,

      "00-99321-012-1525": 13.0,
      "00-99323-012-1525": 13.0,

      "00-99321-016-2030": 17.0,
      "00-99323-016-2030": 17.0,

      "00-99321-020-2540": 22.0,
      "00-99323-020-2540": 22.0,

      "00-99321-025-3050": 27.0,
      "00-99323-025-3050": 27.0


    };


    // ===== 共用：依 料號 帶入 Insert 直徑 =====================================
    function applyInsertDiameterByPart(partNo) {
      const td = document.getElementById('toolDiameter');
      if (PART_TO_DIAMETER.hasOwnProperty(partNo)) {
        td.value = PART_TO_DIAMETER[partNo].toFixed(1);     // 顯示小數一位，例如 11.0
      } else {
        td.value = '';                                      // 沒對照就清空
      }
      if (typeof updateSpindleSpeed === 'function') {       // 若有轉速計算就順便重算
        try { updateSpindleSpeed(); } catch (e) { }
      }
    } // 用來在選到特定 Part No. 時，自動填入 Dc；並觸發轉速重算（若有）

    // ===== 共用：依 料號 建刀桿下拉選單 =======================================
    function buildExtensionOptions(partNo) {
      const extSelect = document.getElementById('extensionBarSelect');
      const allowed = PART_TO_BARS[partNo] || Object.keys(BAR_DB);        // 指定清單或全部
      extSelect.innerHTML = '<option value="" selected disabled>請選擇刀桿</option>';
      allowed.forEach(code => {
        const meta = BAR_DB[code] || { type: "", torque: "" };
        const opt = document.createElement('option');
        opt.value = code;
        opt.dataset.type = meta.type;
        opt.dataset.torque = meta.torque;
        const label = [code];
        if (meta.type) label.push(meta.type);
        if (meta.torque) label.push(`Torque: ${meta.torque}`);
        opt.textContent = label.join(' | ');
        extSelect.appendChild(opt);
      });
    } // 產生刀桿下拉選單（顯示型號/扭力）；白名單未設時放行全部 BAR_DB

    // ===== 共用：隱藏刀桿區塊並重置 ===========================================
    function hideExtensionBar() {
      const extBlock = document.getElementById('extensionBarBlock');
      const extSelect = document.getElementById('extensionBarSelect');
      const extStatus = document.getElementById('extensionBarStatus');
      extBlock.classList.add('d-none');
      extSelect.innerHTML = '<option value="" selected disabled>請選擇刀桿</option>';
      extStatus.textContent = '尚未選擇刀桿。';
      extStatus.className = 'mt-2 text-muted';
    } // 當不需要刀桿選單（如選 99321）時，統一收起並清空內容

    // ===== 主控：由 Part No. 駕馭 UI（你想要的「像 updateExtensionOptions」）====
    function updateUIByPart(partNo) {
      // 1) 先依 Part 帶入 Dc
      applyInsertDiameterByPart(partNo);                                    // 自動填 Insert 直徑

      // 2) 只有 99323 系列顯示刀桿；99321 隱藏
      const is99323 = /^00-99323-/.test(partNo);
      if (!is99323) { hideExtensionBar(); return; }                         // 99321 → 不顯示刀桿

      // 3) 顯示刀桿區塊並依白名單建立選項
      const extBlock = document.getElementById('extensionBarBlock');
      const extStatus = document.getElementById('extensionBarStatus');
      buildExtensionOptions(partNo);                                        // 依料號載入白名單
      extBlock.classList.remove('d-none');
      extStatus.textContent = '尚未選擇刀桿。';
      extStatus.className = 'mt-2 text-muted';
    } // 這隻就是把「由 Part No. 來控制 Dc 與刀桿下拉」的主流程



    //讓選到刀桿時在下方顯示是哪一支（保留不動即可）
    document.getElementById('extensionBarSelect').addEventListener('change', function () {
      const opt = this.options[this.selectedIndex];
      const status = document.getElementById('extensionBarStatus');
      if (opt && opt.value) {
        const bits = [opt.value];
        if (opt.dataset.type) bits.push(opt.dataset.type);
        if (opt.dataset.torque) bits.push(`Torque: ${opt.dataset.torque}`);
        status.textContent = '已選擇刀桿：' + bits.join('｜');
        status.className = 'mt-2 fw-bold text-success';
      } else {
        status.textContent = '尚未選擇刀桿。';
        status.className = 'mt-2 text-muted';
      }
    }); // 顯示「已選擇刀桿：...」




    // ===== 事件：兩組 Part No. 的 onchange 都走這裡 ===========================
    function onPartSelect(sel) {
      const g1 = document.getElementById('partsGroup1'); // 99321
      const g2 = document.getElementById('partsGroup2'); // 99323
      const pickedInfo = document.getElementById('pickedPartInfo');

      // 互斥（先清掉另一組，避免抓到舊值）
      if (sel.id === 'partsGroup1') { g2.selectedIndex = 0; }
      if (sel.id === 'partsGroup2') { g1.selectedIndex = 0; }

      // 顯示 + 切換顏色
      const val = sel.value || sel.options[sel.selectedIndex]?.text;
      if (val) {
        pickedInfo.textContent = `已選擇的 Part No.：${val}`;
        pickedInfo.classList.remove('muted', 'text-muted');
        pickedInfo.classList.add('text-success', 'fw-bold');
      } else {
        pickedInfo.textContent = '尚未選擇 Part No.';
        pickedInfo.classList.remove('text-success', 'fw-bold');
        pickedInfo.classList.add('muted');
      }

      // 依 Part 驅動 UI
      if (val) updateUIByPart(val);

      // 套系列/材料的切削參數
      if (typeof updateCuttingSpeed === 'function') updateCuttingSpeed();

      // 重新判斷 fz 是否要閃
      if (typeof window.syncFzBlink === 'function') window.syncFzBlink();
    }



    // ===== 相容性：保留這個名稱，避免 selectTool 的 onchange 報錯 ==============
    function updateExtensionOptions() {
      // 這隻函式現在改成「由目前選到的 Part」來決定，不再用刀片型號
      const g2 = document.getElementById('partsGroup2'); // 先用 99323
      const g1 = document.getElementById('partsGroup1'); // 再用 99321
      const partNo = g2.value || g1.value || '';
      if (partNo) updateUIByPart(partNo);
    } // 如果你之後把 selectTool 的 onchange 拿掉，這隻也可以移除
  </script>



  <script>
    //材料選擇地的著色
    // 根據所選項目的 data-color 調整下拉背景與提示字
    function updateSelectColor() {
      const sel = document.getElementById('selectMaterial');
      const opt = sel.options[sel.selectedIndex];
      if (!opt) return;

      const color = opt.dataset.color || '';
      const group = opt.dataset.group || '';

      // 著色（原生 select 各瀏覽器支持程度不同，但 Chrome 可）
      sel.style.backgroundColor = color || '';
      // 對比色處理（深色底 -> 白字，淺色底 -> 黑字）
      const whiteTextOn = ['#0066CC', '#FF0000', '#00B050', '#E6007E'];
      sel.style.color = whiteTextOn.includes(color) ? '#fff' : '#000';

      // 顯示 ISO 群組提示
      const hint = document.getElementById('materialHint');
      hint.textContent = group ? `ISO group: ${group}` : 'ISO group: –';
    }

    // 若預設有值，進場時也套色
    document.addEventListener('DOMContentLoaded', () => {
      updateSelectColor();
      updateCuttingSpeed();
    });

  </script>

  <script>
    //材料的帶入數值

    // 依系列區分（可自由調整 99323 的數值）
    const cuttingSpeedMapBySeries = {
      "99321": {                                     // 99321 系列
        Material01: { vc: 120.0 },        // P — 低碳鋼
        Material02: { vc: 100.0 },        // P — 高碳鋼
        Material03: { vc: 70.0 },        // P — 低合金鋼
        Material04: { vc: 60.0 },        // P — 高合金鋼
        Material05: { vc: 0.0 },        // 若未使用可保留
        Material06: { vc: 60.0 },        // M — 不銹鋼
        Material07: { vc: 70.0 },        // K — 鑄鐵
        Material08: { vc: 350.0 },        // N — 鋁合金 
        Material09: { vc: 200.0 },        // N — 銅/銅合金
        Material10: { vc: 20.0 },         // S — 高溫合金
        Material11: { vc: 40.0 },         // S — 鈦/鈦合金
        Material12: { vc: 60.0 }          // H — 調質鋼 < HRC50
      },
      "99323": {                                     // 99323 系列（先與 99321 相同，之後按需要調整）
        Material01: { vc: 200.0 },
        Material02: { vc: 150.0 },
        Material03: { vc: 120.0 },
        Material04: { vc: 90.0 },
        Material05: { vc: 0.0 },
        Material06: { vc: 90.0 },
        Material07: { vc: 120.0 },
        Material08: { vc: 500.0 },
        Material09: { vc: 400.0 },
        Material10: { vc: 30.0 },
        Material11: { vc: 60.0 },
        Material12: { vc: 90.0 }
      }
    };


    function getSelectedPartNo() {
      const g2 = document.getElementById('partsGroup2'); // 99323
      const g1 = document.getElementById('partsGroup1'); // 99321
      return (g2 && g2.value) ? g2.value : (g1 && g1.value) ? g1.value : ""; // 取有值的那組
    }

    function getSeriesFromPart(partNo) {
      if (/^00-99323-/.test(partNo)) return "99323";   // 以料號開頭判斷系列
      if (/^00-99321-/.test(partNo)) return "99321";
      return null;                                      // 尚未選擇 Part No.
    }


    function updateCuttingSpeed() {
      const material = document.getElementById("selectMaterial").value;  // 目前選到的材料
      const partNo = getSelectedPartNo();                                // 目前選到的 Part No.
      const series = getSeriesFromPart(partNo) || "99321";               // 預設用 99321（尚未選擇時）

      const table = cuttingSpeedMapBySeries[series] || {};
      const data = table[material];

      const vcInput = document.getElementById("vc");
      const fzInput = document.getElementById("fz");

      if (data) {
        vcInput.value = data.vc;     // 依系列/材料帶入 Vc
        fzInput.value = data.fz;     // 依系列/材料帶入 fz（若只想分 Vc 也可固定 fz）
        if (typeof updateSpindleSpeed === 'function') updateSpindleSpeed(); // 連動 N/Vf
      } else {
        vcInput.value = "";
        fzInput.value = "";
      }

      if (typeof window.syncFzBlink === 'function') window.syncFzBlink();

    }


  </script>


  <script>
    //轉速進給
    function updateSpindleSpeed() {
      const d = parseFloat(document.getElementById("toolDiameter").value);
      const vc = parseFloat(document.getElementById("vc").value);

      console.log("Tool Diameter =", d);
      console.log("Cutting Speed =", vc);

      if (!isNaN(d) && d > 0 && !isNaN(vc) && vc > 0) {
        const n = (1000 * vc) / (Math.PI * d);
        document.getElementById("n").value = n.toFixed(0);
      } else {
        document.getElementById("n").value = "";
      }

      updateFeedRate();

      if (typeof window.syncFzBlink === 'function') window.syncFzBlink();

    }

    function updateFeedRate() {
      const z = parseFloat(document.getElementById("z").value);
      const fz = parseFloat(document.getElementById("fz").value);
      const n = parseFloat(document.getElementById("n").value);
      if (!isNaN(z) && !isNaN(fz) && !isNaN(n) && z > 0 && fz > 0 && n > 0) {
        const vf = n * fz * z;
        document.getElementById("vf").value = vf.toFixed(2);
      } else {
        document.getElementById("vf").value = "";
      }
    }

  </script>


  <script>//按鈕案件
    //Add TOOL
    function addTool() {
      const toolNo = document.getElementById("toolNo").value;
      const spindleSpeed = document.getElementById("n").value;
      const gcode = `G17 G21 G49 G80\nT${toolNo} M06\nS${spindleSpeed} M03\nM08\n`;
      document.getElementById("result").value += gcode + "\n";
    }

    //Clear
    function clearOutput() {
      document.getElementById("result").value = "";
    }
  </script>

  <script>
    // Fz 閃爍：只有在「該填 fz」時才閃
    (function () {
      const fz = document.getElementById('fz');
      let timer = null;

      // 何時該閃？
      // 1) fz 空白或 <= 0
      // 2) 且已具備計算/加工的其他條件： (vc 與 Dc 都有) 或 (n 已有)
      function shouldBlinkFz() {
        const fzVal = parseFloat(fz.value);
        const isFzMissing = isNaN(fzVal) || fzVal <= 0;

        const vc = parseFloat(document.getElementById('vc').value);
        const d = parseFloat(document.getElementById('toolDiameter').value);
        const n = parseFloat(document.getElementById('n').value);

        const hasVcAndD = !isNaN(vc) && vc > 0 && !isNaN(d) && d > 0;
        const hasN = !isNaN(n) && n > 0;

        return isFzMissing && (hasVcAndD || hasN);
      }

      function startBlink() {
        if (timer) return;
        timer = setInterval(() => fz.classList.toggle('blink'), 650); // 調整頻率在這
      }

      function stopBlink() {
        if (timer) {
          clearInterval(timer);
          timer = null;
        }
        fz.classList.remove('blink');
      }

      function syncFzBlink() {
        if (shouldBlinkFz()) startBlink(); else stopBlink();
      }

      // 對外開放，讓其他流程可觸發同步
      window.syncFzBlink = syncFzBlink;

      // 事件：fz 有輸入就重新判斷
      fz.addEventListener('input', syncFzBlink);

      // 初次載入 / 返回頁面時都同步一次
      document.addEventListener('DOMContentLoaded', syncFzBlink);
      window.addEventListener('pageshow', syncFzBlink);

      // 分頁不可見時停掉計時器，回來再判斷
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) stopBlink(); else syncFzBlink();
      });
    })();

    if (typeof syncFzBlink === 'function') syncFzBlink();

    if (typeof window.syncFzBlink === 'function') window.syncFzBlink();


  </script>


  <script>
    // CE 的部分（清空欄位 + 觸發相關重算 + 聚焦）
    document.addEventListener('DOMContentLoaded', () => {
      function clearField(id) {
        const el = document.getElementById(id);
        if (!el) return;
        el.value = '';
        // 讓其他 oninput 監聽（例如進給/轉速/閃爍）能收到變更
        el.dispatchEvent(new Event('input', { bubbles: true }));
        el.focus();

        // 如有需要，連動重算
        if (typeof updateSpindleSpeed === 'function') updateSpindleSpeed();
        if (typeof window.syncFzBlink === 'function') window.syncFzBlink();
      }

      const preBoreBtn = document.getElementById('preBoreCe');
      const machDiaBtn = document.getElementById('machiningDiaCe');

      if (preBoreBtn) preBoreBtn.addEventListener('click', () => clearField('preBore'));
      if (machDiaBtn) machDiaBtn.addEventListener('click', () => clearField('machiningDia'));
    });
  </script>


  <script>//Maggiew圖片
    // 你要輪播的圖片清單（可換成自己的 URL）
    const images = [
      "https://nine9.jic-tools.com.tw/upload_files/technology/NC_Helix_Drill/icon_helix_fig.01.jpg",
      "https://nine9.jic-tools.com.tw/upload_files/technology/NC_Helix_Drill/icon_helix_fig.02.jpg",
      "https://picsum.photos/300/200?random=22"
    ];

    let idx = 0;
    const imgEl = document.getElementById("galleryImg");
    const prevEl = document.getElementById("btnPrev");
    const nextEl = document.getElementById("btnNext");

    function show(i) {
      idx = (i + images.length) % images.length; // 環狀索引
      imgEl.src = images[idx];
    }

    prevEl.addEventListener("click", () => show(idx - 1));
    nextEl.addEventListener("click", () => show(idx + 1));
  </script>


  <footer class="site-footer mt-5">
    <div class="footer-topbar"></div>
    <div class="container py-5">
      <div class="row gy-4 align-items-start">
        <!-- 1｜Logo / 認證 -->
        <!-- <div class="col-12 col-md-6 col-lg-3 text-center text-lg-start">
          <img src="https://www.jic-tools.com.tw/themes/jictools2/index/images/logo.png" alt="JIMMORE" class="footer-logo mb-3"> -->
        <div class="col-12 col-md-6 col-lg-3 text-center">
          <img src="https://nine9.jic-tools.com.tw/upload_files/technology/NC_Program/Jimmore_footer_logo.png" alt="JIMMORE"
            class="footer-logo mb-3 mx-auto d-block">
          <div class="badge-row mb-3">
            <img src="https://nine9.jic-tools.com.tw/upload_files/technology/NC_Program/Jimmore_footer-iso_01.png"
              alt="SGS">
            <img src="https://nine9.jic-tools.com.tw/upload_files/technology/NC_Program/Jimmore_footer-iso_02.png"
              alt="SGS">
            <img src="https://nine9.jic-tools.com.tw/upload_files/technology/NC_Program/Jimmore_footer-iso_03.png"
              alt="UKAS">
            <!-- <img src="https://picsum.photos/300/300?random=4" alt="UKAS">
            <img src="https://picsum.photos/300/300?random=4" alt="UKAS">
            <img src="https://picsum.photos/300/300?random=4" alt="UKAS">
            <img src="https://picsum.photos/300/300?random=4" alt="UKAS"> -->
          </div>
          <a href="#" target="_blank" rel="noopener">
            <img src="https://www.jic-tools.com.tw/themes/jictools2/images/Jimmore-footer-iso_2.png"
              alt="D-U-N-S Certified" class="duns-img">
            <!-- <img src="https://nine9.jic-tools.com.tw/upload_files/technology/NC_Program/Jimmore_footer-iso_04.png"
              alt="D-U-N-S Certified" class="duns-img"> -->
          </a>
        </div>

        <!-- 2｜Head Office -->
        <div class="col-12 col-md-6 col-lg-3">
          <div class="footer-sec-title">Head Office</div>
          <div class="footer-underline"></div>
          <address class="mb-0 small lh-lg">
            No.120-2, Sec-2 Fusing Rd., South District,<br>
            Taichung City 402014, Taiwan
          </address>
        </div>

        <!-- 3｜Contact / Hours -->
        <div class="col-12 col-md-6 col-lg-3">
          <div class="footer-sec-title">Contact</div>
          <div class="footer-underline"></div>
          <p class="small mb-2">
            TEL：<a href="tel:+886422605352" class="link-light text-decoration-none">+886-4-22605352</a><br>
            FAX：+886-4-22608765<br>
            E-mail：<a href="mailto:trade@jimmore.com.tw"
              class="link-light text-decoration-none">trade@jimmore.com.tw</a>
          </p>
          <div class="footer-sec-title mt-3">Hours</div>
          <div class="footer-underline"></div>
          <p class="small mb-0">Mon–Fri 09:00–18:00 (GMT+8)</p>
        </div>

        <!-- 4｜Legal -->
        <div class="col-12 col-md-6 col-lg-3">
          <div class="footer-sec-title">Legal</div>
          <div class="footer-underline"></div>
          <p class="small mb-2">
            Copyright © <span id="year"></span> Jimmore International Corp.<br>
            All Rights Reserved.
          </p>
          <ul class="list-unstyled small mb-0">
            <li><a href="#" class="link-light text-decoration-none">Privacy Policy</a></li>
            <li><a href="#" class="link-light text-decoration-none">Terms of Use</a></li>
          </ul>
        </div>
      </div>

    </div>

    <script>
      // 動態年份
      document.getElementById('year').textContent = new Date().getFullYear();
    </script>

  </footer>

</body>

</html>
